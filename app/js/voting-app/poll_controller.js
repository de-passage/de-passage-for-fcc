// Generated by CoffeeScript 1.9.3
(function() {
  module.exports = function(Poll) {
    return {
      show: function(req, res) {
        return Poll.findOne({
          name: req.params.name
        }, function(err, poll) {
          return res.render("polls/show.pug", {
            poll: poll,
            user: req.user
          });
        });
      },
      create: function(req, res) {
        var description, name, options, poll, ref;
        ref = req.body, name = ref.name, description = ref.description, options = ref.options;
        poll = new Poll(req.user.name, name, description, Array.slice.call(options));
        return poll.save(function(err, poll) {
          if (err) {
            return res.redirect("/voting-app/polls/new");
          }
          return res.redirect("/voting-app/poll/" + (encodeURIComponent(poll.name)));
        });
      },
      "new": function(req, res) {
        return res.render("polls/new.pug", {
          user: req.user
        });
      },
      edit: function(req, res) {
        return Poll.findOne({
          name: req.params.name
        }, function(err, poll) {
          return res.render("polls/edit.pug", {
            user: req.user,
            poll: poll
          });
        });
      },
      index: function(req, res) {
        return Poll.all(function(err, polls) {
          return res.render("polls/index.pug", {
            user: req.user,
            polls: polls
          });
        });
      },
      update: function(req, res) {
        return Poll.findOne({
          name: req.body.name
        }, function(err, poll) {
          poll.save();
          return res.redirect("/voting-app/poll/" + (encodeURIComponent(poll.name)) + "/edit");
        });
      },
      destroy: function(req, res) {
        return Poll.findOne({
          name: req.body.name
        }, function(err, poll) {
          poll["delete"]();
          return res.redirect("/voting-app/polls");
        });
      }
    };
  };

}).call(this);
