// Generated by CoffeeScript 1.9.3
(function() {
  var ajaxTo, alertError;

  ajaxTo = function(url) {
    return new Promise(function(resolve, reject) {
      return $.ajax(url, {
        method: "POST",
        success: resolve,
        error: reject
      });
    });
  };

  alertError = (function(_this) {
    return function(data) {
      return alert("Error: " + data.responseJSON.error);
    };
  })(this);

  $(function() {
    return window.vue = new Vue({
      el: "#visit-display",
      data: {
        visits: window.yelpVisits,
        yelpId: window.yelpId,
        user_going: window.user_going,
        update_url: window.update_url,
        destroy_url: window.destroy_url,
        user_logged_in: window.user_logged_in
      },
      methods: {
        toggleVisit: function() {
          if (this.user_going) {
            return ajaxTo(destroy_url).then((function(_this) {
              return function(data) {
                vue.visits = data.visits;
                return vue.user_going = false;
              };
            })(this))["catch"](alertError);
          } else {
            return ajaxTo(update_url).then((function(_this) {
              return function(data) {
                vue.visits = data.visits;
                return vue.user_going = true;
              };
            })(this))["catch"](alertError);
          }
        }
      }
    });
  });

}).call(this);
