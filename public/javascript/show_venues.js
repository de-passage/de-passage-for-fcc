// Generated by CoffeeScript 1.9.3
(function() {
  var ajaxTo, alertError;

  ajaxTo = function(url) {
    return new Promise(function(resolve, reject) {
      return $.ajax(url, {
        method: "POST",
        success: resolve,
        error: reject
      });
    });
  };

  alertError = (function(_this) {
    return function(data) {
      return alert("Error: " + data.responseJSON.error);
    };
  })(this);

  $(function() {
    var button;
    button = $("#visit");
    button.click(function() {
      var going, self, url;
      self = $(this);
      url = self.attr("data-path");
      going = self.attr("data-going");
      going = !JSON.parse(going);
      return $.ajax(url, {
        method: "POST",
        success: function(data) {
          self.attr("data-path", data.url);
          if (going) {
            self.html("Cancel my visit");
          } else {
            self.html("I am going");
          }
          self.toggleClass("btn-primary btn-success");
          return self.attr("data-going", going != null ? going : {
            "true": "false"
          });
        }
      });
    });
    return window.vue = new Vue({
      el: "#visit-display",
      data: {
        visits: window.yelpVisits,
        yelpId: window.yelpId,
        user_going: window.user_going,
        update_url: window.update_url,
        destroy_url: window.destroy_url,
        user_logged_in: window.user_logged_in
      },
      methods: {
        toggleVisit: function() {
          console.log(this.user_going);
          if (this.user_going) {
            return ajaxTo(destroy_url).then((function(_this) {
              return function(data) {
                vue.visits = data.visits;
                return vue.user_going = false;
              };
            })(this))["catch"](alertError);
          } else {
            return ajaxTo(update_url).then((function(_this) {
              return function(data) {
                vue.visits = data.visits;
                return vue.user_going = true;
              };
            })(this))["catch"](alertError);
          }
        }
      }
    });
  });

}).call(this);
